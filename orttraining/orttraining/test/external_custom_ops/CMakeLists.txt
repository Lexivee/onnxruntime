project(custom_ops)
find_package(pybind11 REQUIRED)
find_package(PythonInterp 3)
find_package(PythonLibs 3)
add_compile_definitions(ONNX_ML=1)
add_compile_definitions(ONNX_NAMESPACE=onnx)
add_compile_definitions(ONNX_USER_LITE_PROTO=ON)
find_package(Protobuf REQUIRED)
message("Protobuf_PROTOC_EXECUTABLE ${Protobuf_PROTOC_EXECUTABLE}")
message("Protobuf_INCLUDE_DIRS ${Protobuf_INCLUDE_DIRS}")
message("Protobuf_LIBRARIES ${Protobuf_LIBRARIES}")
add_library(custom_ops SHARED src/foo_op.cpp)
execute_process ( COMMAND python -c "from distutils.sysconfig import get_python_lib; print(get_python_lib())" OUTPUT_VARIABLE PYTHON_SITE_PACKAGES OUTPUT_STRIP_TRAILING_WHITESPACE)
target_include_directories(custom_ops PUBLIC ${PYTHON_SITE_PACKAGES} ${PYTHON_SITE_PACKAGES}/onnxruntime/external/include/)
pybind11_add_module(custom_ops src/foo_op.cpp)
